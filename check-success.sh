#!/bin/bash

# ุณูุฑูุจุช ููุชุญูู ูู ูุฌุงุญ ุฅูุดุงุก ุงูุฎุงุฏู

LOG_FILE="$HOME/Desktop/BOOKIN/BOOKIN/instance-creator.log"

echo "=================================="
echo " ูุญุต ูุฌุงุญ ุฅูุดุงุก ุงูุฎุงุฏู"
echo "=================================="
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ ุฑุณุงูุฉ ุงููุฌุงุญ
if grep -q "ูุฌุญ" "$LOG_FILE" 2>/dev/null; then
    echo "๐๐๐ ูุจุฑูู! ุชู ุฅูุดุงุก ุงูุฎุงุฏู ุจูุฌุงุญ!"
    echo ""
    echo "=================================="
    echo "ุชูุงุตูู ุงูุฎุงุฏู:"
    echo "=================================="
    
    # ุนุฑุถ ุขุฎุฑ 30 ุณุทุฑ ูู ุงูุณุฌู
    tail -30 "$LOG_FILE" | grep -A 25 "ูุฌุญ"
    
    echo ""
    echo "=================================="
    echo "ุงูุฎุทูุฉ ุงูุชุงููุฉ:"
    echo "=================================="
    echo "1. ุงูุชุญ Oracle Cloud Console"
    echo "2. ุงุฐูุจ ุฅูู: Menu โ Compute โ Instances"
    echo "3. ุงุจุญุซ ุนู ุงูุฎุงุฏู ุงูุฌุฏูุฏ"
    echo "4. ุงูุณุฎ Public IP"
    echo "5. ุงุชุตู ุจุงูุฎุงุฏู: ssh -i ~/.oci/oci_api_key.pem ubuntu@<PUBLIC_IP>"
    echo ""
    
    exit 0
else
    echo "โณ ูู ููุฌุญ ุจุนุฏ - ุงูุณูุฑูุจุช ูุง ูุฒุงู ูุญุงูู..."
    echo ""
    
    # ุนุฑุถ ุขุฎุฑ ูุญุงููุฉ
    echo "ุขุฎุฑ ูุญุงููุฉ:"
    tail -5 "$LOG_FILE"
    
    echo ""
    
    # ุนุฏ ุนุฏุฏ ุงููุญุงููุงุช
    ATTEMPTS=$(grep -c "ูุญุงููุฉ ุฅูุดุงุก" "$LOG_FILE" 2>/dev/null || echo "0")
    echo "๐ ุนุฏุฏ ุงููุญุงููุงุช ุญุชู ุงูุขู: $ATTEMPTS"
    
    echo ""
    
    # ุงูุชุญูู ูู ุฃู ุงูุณูุฑูุจุช ูุนูู
    if ps aux | grep -v grep | grep -q run-instance-creator; then
        echo "โ ุงูุณูุฑูุจุช ูุนูู - ุงุณุชูุฑ ูู ุงูุงูุชุธุงุฑ"
    else
        echo "โ ุงูุณูุฑูุจุช ูุชููู!"
        echo "๐ก ุดุบููู ุจุฃูุฑ: cd ~/Desktop/BOOKIN/BOOKIN && nohup ./run-instance-creator.sh > instance-creator.log 2>&1 &"
    fi
    
    exit 1
fi
